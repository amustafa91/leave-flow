import{a as d}from"./chunk-YGA4NT5E.js";import{a as m}from"./chunk-A5WJPGEG.js";import{H as h,K as f,Kb as l,M as e,P as u,U as s,a as o,b as n,na as p,x as c}from"./chunk-DENDG36W.js";var v=class r{constructor(i,t){this.http=i;this.authService=t;this.startPolling()}apiUrl=`${m.apiUrl}/notifications`;notifications=p([]);unreadCount=p(0);startPolling(){c(0,3e4).pipe(f(()=>this.authService.isAuthenticated()?this.getMyNotifications():[]),h(3)).subscribe()}getMyNotifications(){return this.http.get(this.apiUrl).pipe(e(i=>{this.notifications.set(i),this.unreadCount.set(i.filter(t=>!t.isRead).length)}))}markAsRead(i){return this.http.put(`${this.apiUrl}/${i}/read`,{}).pipe(e(()=>{this.notifications.update(t=>t.map(a=>a.id===i?n(o({},a),{isRead:!0}):a)),this.unreadCount.set(this.notifications().filter(t=>!t.isRead).length)}))}markAllAsRead(){return this.http.put(`${this.apiUrl}/read-all`,{}).pipe(e(()=>{this.notifications.update(i=>i.map(t=>n(o({},t),{isRead:!0}))),this.unreadCount.set(0)}))}static \u0275fac=function(t){return new(t||r)(s(l),s(d))};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};export{v as a};
