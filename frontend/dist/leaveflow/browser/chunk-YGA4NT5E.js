import{d as u}from"./chunk-6R7RKMAX.js";import{a as p}from"./chunk-A5WJPGEG.js";import{Kb as a,M as n,P as l,U as i,na as s,ub as r}from"./chunk-DENDG36W.js";var m=class o{constructor(e,t){this.http=e;this.router=t;this.loadFromStorage()}apiUrl=`${p.apiUrl}/auth`;currentUser=s(null);token=s(null);user=this.currentUser.asReadonly();isAuthenticated=r(()=>!!this.token());isAdmin=r(()=>{let e=this.currentUser();return e?.role===3||e?.role===2});isApprover=r(()=>{let e=this.currentUser();return e?.role===1||e?.role===2||e?.role===3});login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(n(t=>this.handleAuthResponse(t)))}logout(){this.currentUser.set(null),this.token.set(null),localStorage.removeItem("token"),localStorage.removeItem("user"),this.router.navigate(["/login"])}getToken(){return this.token()}handleAuthResponse(e){this.token.set(e.token),this.currentUser.set(e.user),localStorage.setItem("token",e.token),localStorage.setItem("user",JSON.stringify(e.user))}loadFromStorage(){let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&t&&(this.token.set(e),this.currentUser.set(JSON.parse(t)),this.currentUser.set(JSON.parse(t)))}updateUser(e){this.currentUser.set(e),localStorage.setItem("user",JSON.stringify(e))}static \u0275fac=function(t){return new(t||o)(i(a),i(u))};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a};
