import{a as w,b as k,c as g,d as B,e as N,h as M,i as V,j as G,k as H,o as j,r as A,t as z}from"./chunk-6V3UBU2M.js";import{d as I}from"./chunk-6R7RKMAX.js";import{a as O}from"./chunk-3CDIZWEL.js";import"./chunk-A5WJPGEG.js";import{$ as h,$a as x,Ca as y,Fb as R,Ga as S,Ka as f,Qa as _,Ra as T,Ta as D,Ua as p,Va as L,Wa as E,Xa as i,Ya as t,Za as v,_a as F,aa as C,ab as u,eb as r,fb as q,gb as s,na as b,ya as o}from"./chunk-DENDG36W.js";var P=(a,n)=>n.id;function Y(a,n){if(a&1){let e=F();i(0,"button",25),x("click",function(){let d=h(e).$implicit,m=u();return C(m.selectLeaveType(d))}),i(1,"div",26),v(2,"div",27),i(3,"span",28),r(4),t()(),i(5,"div",19),r(6),t()()}if(a&2){let e,l,d=n.$implicit,m=u();D("p-4 rounded-xl border-2 transition-all text-left "+(((e=m.selectedType())==null?null:e.id)===d.id?"border-emerald-500 bg-emerald-50":"border-[var(--border)] hover:border-emerald-300")),o(2),T("background-color",d.colorCode),o(2),q(d.name),o(2),s(" ",((l=m.getBalance(d.id))==null?null:l.remainingDays)||0," days remaining ")}}function J(a,n){if(a&1&&(i(0,"div",7)(1,"div",29)(2,"span",30),r(3),t(),i(4,"div",31)(5,"div",32)(6,"span",33),r(7,"Remaining"),t(),i(8,"span",34),r(9),t()(),i(10,"div",35)(11,"span",33),r(12,"Accrued"),t(),i(13,"span",34),r(14),t()(),i(15,"div",35)(16,"span",33),r(17,"Total/Year"),t(),i(18,"span",36),r(19),t()()()()()),a&2){let e,l,d,m,c=u();o(3),s("",(e=c.selectedType())==null?null:e.name," Balance"),o(6),s("",((l=c.getBalance(c.selectedType().id))==null?null:l.remainingDays)||0," days"),o(5),s("",((d=c.getBalance(c.selectedType().id))==null?null:d.accruedDays)||0," days"),o(5),s("",((m=c.getBalance(c.selectedType().id))==null?null:m.totalDays)||0," days")}}function K(a,n){a&1&&(i(0,"div")(1,"label",37),r(2,"Hours"),t(),v(3,"input",38),t())}function Q(a,n){if(a&1&&r(0),a&2){let e=u(2);s(" ",e.calculateDays()," days ")}}function U(a,n){if(a&1&&r(0),a&2){let e,l=u(2);s(" ",((e=l.form.get("leaveHours"))==null?null:e.value)||0," hours ")}}function W(a,n){if(a&1&&(i(0,"div",20)(1,"div",39)(2,"span",40),r(3,"Total requested:"),t(),i(4,"span",41),f(5,Q,1,1)(6,U,1,1),t()()()),a&2){let e,l=u();o(5),p((e=l.form.get("isFullDay"))!=null&&e.value?5:6)}}function X(a,n){if(a&1&&(i(0,"div",21),r(1),t()),a&2){let e=u();o(),s(" ",e.error," ")}}function Z(a,n){a&1&&r(0," Submitting... ")}function ee(a,n){a&1&&r(0," Submit Request ")}var $=class a{constructor(n,e,l){this.fb=n;this.leaveService=e;this.router=l;this.form=this.fb.group({startDate:["",g.required],endDate:["",g.required],isFullDay:[!0],leaveHours:[8],reason:[""]})}form;leaveTypes=b([]);balances=b([]);selectedType=b(null);selectedFile=null;loading=!1;error="";ngOnInit(){this.leaveService.getLeaveTypes().subscribe({next:n=>this.leaveTypes.set(n)}),this.leaveService.getMyBalances().subscribe({next:n=>this.balances.set(n)})}selectLeaveType(n){this.selectedType.set(n)}getBalance(n){return this.balances().find(e=>e.leaveTypeId===n)}calculateDays(){let n=new Date(this.form.get("startDate")?.value),e=new Date(this.form.get("endDate")?.value),l=Math.abs(e.getTime()-n.getTime());return Math.ceil(l/(1e3*60*60*24))+1}onFileSelected(n){let e=n.target.files[0];if(e){if(e.size>5*1024*1024){this.error="File size exceeds 5MB",n.target.value="",this.selectedFile=null;return}this.selectedFile=e,this.error=""}}onSubmit(){if(this.form.invalid||!this.selectedType())return;this.loading=!0,this.error="";let n={leaveTypeId:this.selectedType().id,startDate:new Date(this.form.get("startDate")?.value),endDate:new Date(this.form.get("endDate")?.value),isFullDay:this.form.get("isFullDay")?.value,leaveHours:this.form.get("isFullDay")?.value?0:this.form.get("leaveHours")?.value||8,reason:this.form.get("reason")?.value};this.leaveService.createRequest(n,this.selectedFile||void 0).subscribe({next:()=>{this.router.navigate(["/dashboard"])},error:e=>{this.error=e.error?.message||"Failed to submit request",this.loading=!1}})}cancel(){this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||a)(y(A),y(O),y(I))};static \u0275cmp=S({type:a,selectors:[["app-leave-request"]],decls:46,vars:7,consts:[[1,"max-w-2xl","animate-fadeIn"],[1,"text-2xl","font-bold","text-[var(--text-primary)]","mb-6"],[1,"card"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"block","text-sm","font-medium","text-[var(--text-primary)]","mb-2"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-3"],["type","button",3,"class"],[1,"p-4","bg-blue-50","border","border-blue-200","rounded-xl","animate-fadeIn"],[1,"grid","grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-[var(--text-primary)]","mb-1.5"],["type","date","formControlName","startDate",1,"input"],["type","date","formControlName","endDate",1,"input"],[1,"space-y-3"],[1,"flex","items-center","gap-3"],["type","checkbox","formControlName","isFullDay","id","fullDay",1,"w-4","h-4","rounded","border-[var(--border)]","text-emerald-600","focus:ring-emerald-500"],["for","fullDay",1,"text-sm","text-[var(--text-primary)]"],["formControlName","reason","rows","3","placeholder","Briefly describe why you're taking leave...",1,"input","resize-none"],[1,"flex","flex-col","gap-2"],["type","file",1,"block","w-full","text-sm","text-[var(--text-secondary)]","file:mr-4","file:py-2","file:px-4","file:rounded-full","file:border-0","file:text-sm","file:font-semibold","file:bg-emerald-50","file:text-emerald-700","hover:file:bg-emerald-100",3,"change"],[1,"text-xs","text-[var(--text-secondary)]"],[1,"p-4","rounded-xl","bg-emerald-50","border","border-emerald-200"],[1,"p-3","rounded-lg","bg-red-50","border","border-red-200","text-red-700","text-sm"],[1,"flex","gap-3","pt-4"],["type","button",1,"btn","btn-secondary","flex-1",3,"click"],["type","submit",1,"btn","btn-primary","flex-1","disabled:opacity-50",3,"disabled"],["type","button",3,"click"],[1,"flex","items-center","gap-2","mb-1"],[1,"w-3","h-3","rounded-full"],[1,"font-medium","text-[var(--text-primary)]"],[1,"flex","flex-col","sm:flex-row","justify-between","sm:items-center","gap-2"],[1,"font-medium","text-blue-900"],[1,"flex","gap-4","text-sm"],[1,"flex","flex-col"],[1,"text-blue-700","text-xs","uppercase","tracking-wider"],[1,"font-bold","text-blue-900","text-lg"],[1,"flex","flex-col","border-l","border-blue-200","pl-4"],[1,"text-blue-900","text-lg"],[1,"block","text-sm","font-medium","text-[var(--text-secondary)]","mb-1"],["type","number","formControlName","leaveHours","step","0.5","min","0.5","placeholder","4",1,"input","w-32"],[1,"flex","justify-between","items-center"],[1,"text-emerald-800"],[1,"text-2xl","font-bold","text-emerald-700"]],template:function(e,l){if(e&1&&(i(0,"div",0)(1,"h1",1),r(2,"Request Leave"),t(),i(3,"div",2)(4,"form",3),x("ngSubmit",function(){return l.onSubmit()}),i(5,"div")(6,"label",4),r(7,"Leave Type"),t(),i(8,"div",5),L(9,Y,7,6,"button",6,P),t()(),f(11,J,20,4,"div",7),i(12,"div",8)(13,"div")(14,"label",9),r(15,"Start Date"),t(),v(16,"input",10),t(),i(17,"div")(18,"label",9),r(19,"End Date"),t(),v(20,"input",11),t()(),i(21,"div",12)(22,"div",13),v(23,"input",14),i(24,"label",15),r(25,"Full day(s)"),t()(),f(26,K,4,0,"div"),t(),i(27,"div")(28,"label",9),r(29,"Reason (optional)"),t(),v(30,"textarea",16),t(),i(31,"div")(32,"label",9),r(33,"Attachment (optional)"),t(),i(34,"div",17)(35,"input",18),x("change",function(m){return l.onFileSelected(m)}),t(),i(36,"p",19),r(37," Recommended for Sick Leave. Max 5MB. "),t()()(),f(38,W,7,1,"div",20)(39,X,2,1,"div",21),i(40,"div",22)(41,"button",23),x("click",function(){return l.cancel()}),r(42,"Cancel"),t(),i(43,"button",24),f(44,Z,1,0)(45,ee,1,0),t()()()()()),e&2){let d,m;o(4),_("formGroup",l.form),o(5),E(l.leaveTypes()),o(2),p(l.selectedType()?11:-1),o(15),p((d=l.form.get("isFullDay"))!=null&&d.value?-1:26),o(12),p(l.selectedType()&&((m=l.form.get("startDate"))!=null&&m.value)&&((m=l.form.get("endDate"))!=null&&m.value)?38:-1),o(),p(l.error?39:-1),o(4),_("disabled",l.loading||l.form.invalid||!l.selectedType()),o(),p(l.loading?44:45)}},dependencies:[R,z,M,k,V,w,B,N,j,G,H],encapsulation:2})};export{$ as LeaveRequestComponent};
